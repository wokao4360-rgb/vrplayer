const y=["辱骂","傻逼","垃圾","滚开","暴力","色情","黄色","毒品","赌博","诈骗","恐怖","自杀","枪","炸弹","仇恨","歧视","hate","suicide","bomb","porn"];function u(t){return(t||"").toLowerCase().replace(/\s+/g,"").replace(/[^\p{L}\p{N}]+/gu,"")}function C(t){const e=u(t);return e?y.some(n=>e.includes(u(String(n)))):!1}const c="vr_user",l="vr_comments_v1",f="vr_likes_v1",E=1e4,B=200,N=50;function a(t,e){if(!t)return e;try{return JSON.parse(t)}catch{return e}}function d(t){return`${t}_${Date.now()}_${Math.random().toString(16).slice(2,8)}`}function m(){const t=a(localStorage.getItem(c),null);return!t||typeof t!="object"||typeof t.id!="string"||typeof t.name!="string"?null:{id:t.id,name:t.name}}function v(t){const e={id:d("u"),name:t};return localStorage.setItem(c,JSON.stringify(e)),e}function U(){localStorage.removeItem(c)}function g(){const t=a(localStorage.getItem(l),[]);return Array.isArray(t)?t:[]}function O(t){localStorage.setItem(l,JSON.stringify(t))}function D(t){return g().filter(e=>e.sceneId===t).sort((e,n)=>n.ts-e.ts).slice(0,N)}function I(t,e){const n=m();if(!n)return{ok:!1,reason:"not_logged_in"};const s=(e||"").trim();if(C(s))return{ok:!1,reason:"banned"};const o=g(),r=o.filter(i=>i.sceneId===t&&i.userId===n.id).sort((i,_)=>_.ts-i.ts)[0];if(r&&Date.now()-r.ts<E)return{ok:!1,reason:"cooldown"};const k=[{id:d("c"),sceneId:t,userId:n.id,userName:n.name,text:s,ts:Date.now()},...o].slice(0,B);return O(k),{ok:!0}}function S(){return a(localStorage.getItem(f),{likesCountByScene:{},likedByUser:{}})}function p(t){localStorage.setItem(f,JSON.stringify(t))}function L(t,e){var r;const n=S(),s=n.likesCountByScene[t]||0,o=e?!!((r=n.likedByUser[e])!=null&&r[t]):!1;return{count:s,liked:o}}function K(t,e){return L(t,e)}function w(t){const e=m();if(!e)return{ok:!1,reason:"login_required"};const n=S();n.likedByUser[e.id]||(n.likedByUser[e.id]={});const o=!!!n.likedByUser[e.id][t];n.likedByUser[e.id][t]=o;const r=n.likesCountByScene[t]||0;return n.likesCountByScene[t]=Math.max(0,r+(o?1:-1)),p(n),{ok:!0,action:o?"liked":"unliked",count:n.likesCountByScene[t]}}export{v as a,I as b,K as c,D as d,m as g,U as l,w as t};
