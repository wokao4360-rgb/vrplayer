# task_plan.md

## 任务
VRPlayer 第四轮深入优化（在“全速渲染 + 不降画质”前提下，提升首屏与整体网络访问速度）

## 时间
- 创建时间：2026-02-11 18:51:14
- 最新更新：2026-02-11 19:15:19

## 已完成基线
- 第一轮：入口依赖瘦身、Dock 惰性化、CDN 后台探测、关键生命周期清理。
- 第二轮：KTX2/three-extras 按需化、聊天首交互触发、SW 壳层预缓存、发布上线。
- 第三轮：main 入口深度解耦、SceneListPage 拆分、路由级按需加载、发布上线。

## 第四轮阶段状态
- [x] 阶段0：规划文件中文化与编码治理（清理乱码/控制字符，统一简体中文记录）
- [x] 阶段1（P0）：图片请求调度器落地（分通道并发：tile/pano/preload/ui）
- [x] 阶段2（P1）：CDN 探测并行竞速 + 默认超时收敛到 1000ms
- [x] 阶段3（P1）：SW 跨域全景缓存对齐（保持 /config.json network-only）
- [x] 阶段4（P2）：输入事件聚合到每帧应用，保持全速渲染并默认关闭自动节流降载
- [x] 阶段5：构建验证 + chrome-devtools 证据采样
- [ ] 阶段6：按 SOP 发布（dist -> docs -> commit -> push）

## 约束
- 不降帧率，不降画质，渲染循环保持全速。
- 不手改 dist/**、docs/**。
- 所有“修复成立”结论必须有 MCP 证据（snapshot + network/console）。

## 关键决策
| 决策 | 原因 |
|---|---|
| 引入分通道并发调度器 | 解除全局并发=2 的瓶颈，提升全景与瓦片爬升速度 |
| CDN probe 并行化 | 缩短可用 CDN 选路时间，弱网下更快可用 |
| SW 支持跨域全景缓存 | 提升回访命中与跨域资源复用 |
| 事件增量每帧应用 | 降低高频输入导致的主线程抖动，提升流畅性 |
| 默认关闭自动 tile 节流 | 满足“全速渲染、不降载”要求 |

## 风险与应对
| 风险 | 应对 |
|---|---|
| 并发提高导致弱网抖动 | 按设备档位区分并发上限（桌面/移动） |
| 跨域缓存不可见头部 | 允许 opaque 响应缓存，仅限全景资源路径 |
| 调整输入链路引发交互回归 | 用 chrome-devtools 做交互与网络双采样回归 |
