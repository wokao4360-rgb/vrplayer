var I=Object.defineProperty;var S=(i,e,o)=>e in i?I(i,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[e]=o;var a=(i,e,o)=>S(i,typeof e!="symbol"?e+"":e,o);import{y as k}from"./three-math-BTl9b1HC.js";import{s as y,p as b,o as L}from"./index-eWkhSg8A.js";import"./three-renderer-toiwjbvW.js";function T(){return`
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2" />
  <path d="M16.2 16.2 21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
</svg>`}function H(){return`
<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path d="M9 7.5v9l8-4.5-8-4.5Z"/>
</svg>`}function C(i){const e=document.createElement("div");return e.className="hotspot-tooltip",e.textContent=i||"",e.setAttribute("role","tooltip"),e}function w(i,e){const o=document.createElement("div");return o.className=`hotspot-icon-circle${e?` ${e}`:""}`,o.innerHTML=i,o}function F(){return`
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M12 4v16M12 4l6 6M12 4l-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`}function M(i){const e=C(i.tooltip),o=i.isGround??!1;let s="hotspot hotspot--unknown",n=document.createElement("div");n.className="hotspot-dot";const l=i.type;if(o){s="hotspot hotspot--ground";const t=document.createElement("div");t.className="hotspot-ground-ring",n=t}else l==="scene"?(s="hotspot hotspot--scene",n=w(F(),"hotspot-icon hotspot-icon-arrow")):l==="image"?(s="hotspot hotspot--image",n=w(T(),"hotspot-icon")):l==="info"?(s="hotspot hotspot--info",n=w('<span class="hotspot-info-text">i</span>',"hotspot-icon")):l==="video"&&(s="hotspot hotspot--video",n=w(H(),"hotspot-icon hotspot-icon-play"));return{rootClassName:s,contentEl:n,tooltipEl:e}}class E{constructor(e){a(this,"data");a(this,"el");a(this,"contentEl");a(this,"tooltipEl");a(this,"labelEl",null);a(this,"worldPos");a(this,"radius",500);a(this,"tooltipTimer",null);var t,r;this.data=e,this.el=document.createElement("div");const o=e.pitch<-20,s=M({id:e.id,type:e.type,tooltip:e.tooltip,isGround:o});if(this.el.className=s.rootClassName,o&&this.el.classList.add("hotspot--ground"),this.el.setAttribute("data-hotspot-id",e.id),this.el.setAttribute("data-hotspot-type",e.type),this.el.style.pointerEvents="auto",this.el.style.position="absolute",this.el.style.left="0",this.el.style.top="0",this.contentEl=s.contentEl,this.tooltipEl=s.tooltipEl,e.label){const c=document.createElement("div");c.className="hotspot-label",c.textContent=e.label,c.setAttribute("aria-hidden","true"),this.labelEl=c}this.el.appendChild(this.contentEl),this.el.appendChild(this.tooltipEl),this.labelEl&&this.el.appendChild(this.labelEl),(((r=(t=window.matchMedia)==null?void 0:t.call(window,"(hover: hover) and (pointer: fine)"))==null?void 0:r.matches)??!1)&&(this.el.addEventListener("mouseenter",()=>this.showTooltip()),this.el.addEventListener("mouseleave",()=>this.hideTooltip())),this.el.addEventListener("pointerdown",c=>{c.stopPropagation(),this.el.classList.add("is-pressed")});const l=()=>this.el.classList.remove("is-pressed");this.el.addEventListener("pointerup",l),this.el.addEventListener("pointercancel",l),this.el.addEventListener("pointerleave",l)}getElement(){return this.el}getData(){return this.data}updateScreenPosition(e,o){const s=k(this.data.yaw,this.data.pitch,e,o,this.radius);if(!s.visible){this.el.style.display="none",this.el.style.opacity="0";return}this.el.style.display="",this.el.style.opacity="1",this.el.style.setProperty("--hs-x",`${s.x}px`),this.el.style.setProperty("--hs-y",`${s.y}px`),this.el.style.transform=`translate3d(${s.x}px, ${s.y}px, 0) translate(-50%, -50%)`}showTooltip(e){this.data.tooltip&&(this.tooltipEl.classList.add("show"),this.tooltipTimer&&(window.clearTimeout(this.tooltipTimer),this.tooltipTimer=null),e&&e>0&&(this.tooltipTimer=window.setTimeout(()=>this.hideTooltip(),e)))}hideTooltip(){this.tooltipEl.classList.remove("show"),this.tooltipTimer&&(window.clearTimeout(this.tooltipTimer),this.tooltipTimer=null)}}class N extends E{onClick(){console.log("[hotspot] scene click",{id:this.data.id,targetSceneId:this.data.targetSceneId})}}class P extends E{onClick(){if(!this.data.imageUrl){console.warn("[hotspot] image click but no src configured",this.data),y("未配置内容",1500);return}b({type:"image",payload:{src:this.data.imageUrl,title:this.data.title||this.data.tooltip}})}}class $ extends E{onClick(){if(!!!(this.data.text||this.data.title||this.data.tooltip)){console.warn("[hotspot] info click but no text/title configured",this.data),y("未配置内容",1500);return}b({type:"info",payload:{title:this.data.title||this.data.tooltip,text:this.data.text}})}}class D extends E{onClick(){if(!this.data.url){console.warn("[hotspot] video click but no src/url configured",this.data),y("未配置内容",1500);return}b({type:"video",payload:{src:this.data.url,poster:this.data.poster,title:this.data.title||this.data.tooltip}})}}class V{constructor(e,o,s={}){a(this,"element");a(this,"viewer");a(this,"disposeFrameListener",null);a(this,"hotspotInstances",[]);a(this,"options");a(this,"unsubscribeFocus",null);a(this,"hoveredSceneId",null);this.viewer=e,this.options=s,this.element=document.createElement("div"),this.element.className="hotspots-container",this.element.style.pointerEvents="none",this.updateHotspots(o);const n=this.viewer.getDomElement();this.disposeFrameListener=this.viewer.onFrame(()=>{const l=this.viewer.getCamera();for(const t of this.hotspotInstances)t.updateScreenPosition(l,n)}),this.unsubscribeFocus=L(l=>{this.handleSceneFocus(l)})}handleSceneFocus(e){if(e.type==="hover"&&e.source!=="pano"){if(this.options.museumId&&e.museumId!==this.options.museumId)return;const o=e.sceneId;this.hoveredSceneId!==o&&(this.hoveredSceneId&&this.setHotspotHighlight(this.hoveredSceneId,!1),this.hoveredSceneId=o,o&&this.setHotspotHighlight(o,!0))}}setHotspotHighlight(e,o){this.hotspotInstances.forEach(s=>{const n=s.getData();if(n.type==="scene"&&n.targetSceneId===e){const t=s.getElement();o?t.classList.add("hotspot--external-hover"):t.classList.remove("hotspot--external-hover")}})}updateHotspots(e){var n,l;this.hotspotInstances=[],this.element.innerHTML="";const o=((l=(n=window.matchMedia)==null?void 0:n.call(window,"(hover: none) and (pointer: coarse)"))==null?void 0:l.matches)??!1,s=t=>{var r,c,u,g,m,f,d,x;if(t.type==="scene"){const p=(r=t.target)==null?void 0:r.sceneId,h=p?(u=(c=this.options).resolveSceneName)==null?void 0:u.call(c,p):void 0,v=`进入：${h||t.label||p||"未知场景"}`;return new N({id:t.id,type:"scene",yaw:t.yaw,pitch:t.pitch,label:t.label||h||p,tooltip:v,targetSceneId:p})}if(t.type==="video"){const p=((g=t.target)==null?void 0:g.url)||t.src,h=((m=t.target)==null?void 0:m.poster)||t.poster,v=t.title||t.label;return new D({id:t.id,type:"video",yaw:t.yaw,pitch:t.pitch,label:t.label,tooltip:v,url:p,poster:h,title:v})}if(t.type==="image"){const p=((f=t.target)==null?void 0:f.imageUrl)||((d=t.target)==null?void 0:d.url)||t.src,h=t.title||t.label;return new P({id:t.id,type:"image",yaw:t.yaw,pitch:t.pitch,label:t.label,tooltip:h,imageUrl:p,title:h})}if(t.type==="info"){const p=t.title||t.label,h=((x=t.target)==null?void 0:x.text)||t.text;return new $({id:t.id,type:"info",yaw:t.yaw,pitch:t.pitch,label:t.label,tooltip:p,text:h,title:p})}return null};for(const t of e){const r=s(t);r&&(r.getElement().addEventListener("click",c=>{var m,f;c.preventDefault(),c.stopPropagation();const u=r.getData(),g=u.type==="scene";if(o&&r.showTooltip(1200),g){const d=u.targetSceneId;if(d&&this.options.onEnterScene){y(`进入 ${((f=(m=this.options).resolveSceneName)==null?void 0:f.call(m,d))||d}`,1e3),this.options.onEnterScene(d);return}}r.onClick()}),this.hotspotInstances.push(r),this.element.appendChild(r.getElement()))}}getElement(){return this.element}remove(){this.disposeFrameListener&&(this.disposeFrameListener(),this.disposeFrameListener=null),this.unsubscribeFocus&&(this.unsubscribeFocus(),this.unsubscribeFocus=null),this.element.remove()}}export{V as Hotspots,P as ImageHotspot,$ as InfoHotspot,N as SceneLinkHotspot,D as VideoHotspot};
