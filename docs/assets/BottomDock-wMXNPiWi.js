const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./dock-panels-D_S9uN6p.js","./index-I51ows0J.js","./index-BfJu72vJ.css"])))=>i.map(i=>d[i]);
var h=Object.defineProperty;var r=(i,e,s)=>e in i?h(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s;var t=(i,e,s)=>r(i,typeof e!="symbol"?e+"":e,s);import{Z as a,i as u,_ as m}from"./index-I51ows0J.js";import{m as d}from"./Modal-Cmv3TBkb.js";import{g as p}from"./index-DnDnySW2.js";const b=[{key:"guide",label:a.dock.guide},{key:"community",label:a.dock.community},{key:"info",label:a.dock.info},{key:"settings",label:a.dock.settings}];function o(i){return i==="community"||i==="map"||i==="dollhouse"}class y{constructor(e={}){t(this,"element");t(this,"dockEl");t(this,"panelsHost");t(this,"panels",null);t(this,"panelsLoadPromise",null);t(this,"destroyed",!1);t(this,"activeTabs");t(this,"onGuideClick");t(this,"onOpenCommunity");t(this,"onOpenInfo");t(this,"onOpenSettings");t(this,"initialTab");t(this,"sceneId");t(this,"sceneName");t(this,"museum");t(this,"scenes");t(this,"currentSceneId");t(this,"unsubscribeInteracting",null);t(this,"unsubscribeIdle",null);t(this,"unsubscribeUIEngaged",null);t(this,"handleDockTabOpen");t(this,"handleDockTabClose");t(this,"handleClosePanels");this.activeTabs=new Set,this.onGuideClick=e.onGuideClick,this.onOpenCommunity=e.onOpenCommunity,this.onOpenInfo=e.onOpenInfo,this.onOpenSettings=e.onOpenSettings,this.initialTab=e.initialTab||"guide",this.sceneId=e.sceneId,this.sceneName=e.sceneName,this.museum=e.museum,this.scenes=e.scenes,this.currentSceneId=e.currentSceneId||e.sceneId,this.element=document.createElement("div"),this.element.className="vr-dock-wrap",this.panelsHost=document.createElement("div"),this.panelsHost.className="vr-dock-panels-host",this.element.appendChild(this.panelsHost),this.dockEl=document.createElement("div"),this.dockEl.className="vr-dock vr-glass",this.element.appendChild(this.dockEl);for(const s of b){const n=document.createElement("button");n.className="vr-btn vr-dock-tab",n.setAttribute("data-tab",s.key);const l=s.key==="guide"?"guide":s.key==="community"?"community":s.key==="info"?"info":"more";n.innerHTML=`<span class="vr-dock-tab-icon">${p(l)}</span><div class="vr-dock-tab-label">${s.label}</div>`,n.addEventListener("click",c=>{if(c.preventDefault(),c.stopPropagation(),u.emitUIEngaged(),s.key==="guide"){this.setTabActive("guide",!0),this.onGuideClick&&this.onGuideClick();return}if(s.key==="community"){this.onOpenCommunity&&this.onOpenCommunity(),this.setTabActive("community",!0);return}if(s.key==="info"){this.setTabActive("info",!0),this.onOpenInfo?this.onOpenInfo():this.openFallbackInfoModal();return}this.setTabActive("settings",!0),this.onOpenSettings?this.onOpenSettings():this.openFallbackSettingsModal()}),this.dockEl.appendChild(n)}this.syncActiveClass(),this.setupInteractionListeners(),this.setupDockEventListeners(),o(this.initialTab)&&this.setTabActive(this.initialTab,!0)}async ensurePanels(){return this.panels?this.panels:this.panelsLoadPromise?(await this.panelsLoadPromise,this.panels):(this.panelsLoadPromise=(async()=>{const{DockPanels:e}=await m(async()=>{const{DockPanels:n}=await import("./dock-panels-D_S9uN6p.js").then(l=>l.D);return{DockPanels:n}},__vite__mapDeps([0,1,2]),import.meta.url);if(this.destroyed)return;const s=new e({initialTab:this.initialTab,sceneId:this.sceneId,sceneName:this.sceneName,museum:this.museum,scenes:this.scenes,currentSceneId:this.currentSceneId||this.sceneId});if(s.setVisible(!0),this.destroyed){s.remove();return}this.panels=s,this.panelsHost.appendChild(s.getElement())})().finally(()=>{this.panelsLoadPromise=null}),await this.panelsLoadPromise,this.panels)}async openPanelTab(e){const s=await this.ensurePanels();!s||this.destroyed||s.setTab(e)}setupInteractionListeners(){}syncActiveClass(){this.dockEl.querySelectorAll(".vr-dock-tab").forEach(s=>{const n=s.getAttribute("data-tab");n&&this.activeTabs.has(n)?s.classList.add("active"):s.classList.remove("active")})}setTabActive(e,s){if(s?this.activeTabs.add(e):this.activeTabs.delete(e),this.syncActiveClass(),s&&o(e)){this.openPanelTab(e);return}!s&&o(e)&&this.panels&&!(this.activeTabs.has("community")||this.activeTabs.has("map")||this.activeTabs.has("dollhouse"))&&this.panels.closeAllPanels&&this.panels.closeAllPanels()}isTabActive(e){return this.activeTabs.has(e)}setupDockEventListeners(){this.handleDockTabOpen=e=>{var n;const s=e;(n=s.detail)!=null&&n.tab&&this.setTabActive(s.detail.tab,!0)},this.handleDockTabClose=e=>{var n;const s=e;(n=s.detail)!=null&&n.tab&&this.setTabActive(s.detail.tab,!1)},this.handleClosePanels=()=>{var e;this.setTabActive("community",!1),this.setTabActive("map",!1),this.setTabActive("dollhouse",!1),(e=this.panels)!=null&&e.closeAllPanels&&this.panels.closeAllPanels()},window.addEventListener("vr:dock-tab-open",this.handleDockTabOpen),window.addEventListener("vr:dock-tab-close",this.handleDockTabClose),window.addEventListener("vr:close-panels",this.handleClosePanels)}setSceneContext(e,s){this.sceneId=e,this.sceneName=s,this.currentSceneId=e,this.panels&&this.panels.setSceneContext(e,s)}setMuseumContext(e,s,n){this.museum=e,this.scenes=s,this.currentSceneId=n,this.panels&&this.panels.setMuseumContext(e,s,n)}getElement(){return this.element}setMoreOpen(e){e?this.element.classList.add("dock--more-open"):this.element.classList.remove("dock--more-open")}openFallbackInfoModal(){d({title:"信息",contentHtml:`
        <div class="vr-modal-info-list">
          <div><span class="vr-modal-info-row-label">馆：</span><span>-</span></div>
          <div><span class="vr-modal-info-row-label">场景：</span><span>-</span></div>
          <div><span class="vr-modal-info-row-label">采集日：</span><span>2025-12-27</span></div>
        </div>
      `})}openFallbackSettingsModal(){d({title:"设置",contentHtml:`
        <div class="vr-modal-settings-list">
          <div>此版本暂未接入设置功能。</div>
        </div>
      `})}remove(){this.destroyed=!0,this.unsubscribeInteracting&&(this.unsubscribeInteracting(),this.unsubscribeInteracting=null),this.unsubscribeIdle&&(this.unsubscribeIdle(),this.unsubscribeIdle=null),this.unsubscribeUIEngaged&&(this.unsubscribeUIEngaged(),this.unsubscribeUIEngaged=null),this.handleDockTabOpen&&(window.removeEventListener("vr:dock-tab-open",this.handleDockTabOpen),this.handleDockTabOpen=void 0),this.handleDockTabClose&&(window.removeEventListener("vr:dock-tab-close",this.handleDockTabClose),this.handleDockTabClose=void 0),this.handleClosePanels&&(window.removeEventListener("vr:close-panels",this.handleClosePanels),this.handleClosePanels=void 0),this.panels&&(this.panels.remove(),this.panels=null),this.element.remove()}}export{y as BottomDock};
