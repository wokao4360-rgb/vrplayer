const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BottomDock-Dc4rs3Kg.js","./index-CE53-grs.js","./Modal-Cmv3TBkb.js","./index-DnDnySW2.js","./index-BfJu72vJ.css","./Hotspots-D0fpW1pi.js","./three-math-BTl9b1HC.js","./three-renderer-toiwjbvW.js","./VideoPlayer-hyuQhf2k.js","./GuideTray-DTU6fKkr.js","./externalImage-Cn8sVw7v.js","./SceneGuideDrawer-C210sT8t.js","./QualityIndicator-Nn0Chj1w.js","./chat-community-Cmxv6vIZ.js","./store-B83L8bDT.js"])))=>i.map(i=>d[i]);
var f=Object.defineProperty;var M=(n,e,i)=>e in n?f(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i;var t=(n,e,i)=>M(n,typeof e!="symbol"?e+"":e,i);import{_ as d,L as m}from"./index-CE53-grs.js";const a=typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback:null,h=typeof window<"u"&&"cancelIdleCallback"in window?window.cancelIdleCallback:null;class y{constructor(e){t(this,"options");t(this,"disposed",!1);t(this,"coreMounted",!1);t(this,"coreMounting",!1);t(this,"deferredMounted",!1);t(this,"deferredMounting",!1);t(this,"observerMounted",!1);t(this,"observerMounting",!1);t(this,"observerIdleHandle",null);t(this,"bottomDock",null);t(this,"topModeTabs",null);t(this,"hotspots",null);t(this,"videoPlayer",null);t(this,"guideTray",null);t(this,"sceneGuideDrawer",null);t(this,"qualityIndicator",null);t(this,"handleMetricsEvent",null);t(this,"videoPlayerModulePromise",null);t(this,"guideTrayModulePromise",null);t(this,"sceneGuideDrawerModulePromise",null);t(this,"qualityIndicatorModulePromise",null);this.options=e}getBottomDock(){return this.bottomDock}getTopModeTabs(){return this.topModeTabs}getHotspots(){return this.hotspots}getVideoPlayer(){return this.videoPlayer}getGuideTray(){return this.guideTray}getSceneGuideDrawer(){return this.sceneGuideDrawer}getQualityIndicator(){return this.qualityIndicator}async mountCore(){if(!(this.coreMounted||this.coreMounting||this.disposed||!this.isAlive())){this.coreMounting=!0;try{const[{BottomDock:e},{TopModeTabs:i},{Hotspots:o}]=await Promise.all([d(()=>import("./BottomDock-Dc4rs3Kg.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),d(()=>import("./TopModeTabs-psisWFio.js"),[],import.meta.url),d(()=>import("./Hotspots-D0fpW1pi.js"),__vite__mapDeps([5,6,7,1,4]),import.meta.url)]);if(this.coreMounted||this.disposed||!this.isAlive())return;const r=this.options.getPanoViewer();if(!r)return;const l=new Map(this.options.museum.scenes.map(s=>[s.id,s.name]));this.bottomDock=new e({onGuideClick:()=>{this.openGuideTray()},onOpenCommunity:()=>{this.options.onOpenCommunity()},onOpenInfo:this.options.onOpenInfo,onOpenSettings:this.options.onOpenSettings,sceneId:this.options.scene.id,sceneName:this.options.scene.name,museum:this.options.museum,scenes:this.options.museum.scenes,currentSceneId:this.options.scene.id}),this.options.appElement.appendChild(this.bottomDock.getElement()),this.topModeTabs=new i({initialMode:this.options.initialMode,onModeChange:this.options.onModeChange}),this.options.appElement.appendChild(this.topModeTabs.getElement()),this.hotspots=new o(r,this.options.scene.hotspots,{resolveSceneName:s=>l.get(s),onEnterScene:this.options.onEnterScene,museumId:this.options.museum.id}),this.options.viewerContainer.appendChild(this.hotspots.getElement()),this.coreMounted=!0}finally{this.coreMounting=!1}}}async mountDeferred(){if(!(this.deferredMounted||this.deferredMounting||this.disposed||!this.isAlive())){this.deferredMounting=!0;try{const[{VideoPlayer:e},{GuideTray:i}]=await Promise.all([this.loadVideoPlayerModule(),this.loadGuideTrayModule()]);if(this.deferredMounted||this.disposed||!this.isAlive())return;this.videoPlayer||(this.videoPlayer=new e,this.options.appElement.appendChild(this.videoPlayer.getElement())),this.guideTray||(this.guideTray=new i({museumId:this.options.museum.id,currentSceneId:this.options.scene.id,scenes:this.options.museum.scenes,onSceneClick:o=>{this.options.onEnterScene(o)},onMoreClick:()=>{this.openSceneGuideDrawer()},onClose:()=>{var o;(o=this.guideTray)==null||o.setVisible(!1),window.dispatchEvent(new CustomEvent("vr:dock-tab-close",{detail:{tab:"guide"}}))}}),this.guideTray.setVisible(!1),this.options.appElement.appendChild(this.guideTray.getElement())),this.deferredMounted=!0}finally{this.deferredMounting=!1}}}scheduleObserverMount(){if(!(this.observerMounted||this.observerMounting||this.disposed||this.observerIdleHandle!==null)){if(a&&h){this.observerIdleHandle=a(()=>{this.observerIdleHandle=null,this.mountObserver()},{timeout:1200});return}this.observerIdleHandle=window.setTimeout(()=>{this.observerIdleHandle=null,this.mountObserver()},500)}}handleStatusChange(e){var i;(i=this.qualityIndicator)==null||i.updateStatus(e),(e===m.HIGH_READY||e===m.DEGRADED)&&this.scheduleObserverMount()}dispose(){var e,i,o,r,l,s;this.disposed=!0,this.observerIdleHandle!==null&&(a&&h?h(this.observerIdleHandle):clearTimeout(this.observerIdleHandle),this.observerIdleHandle=null),this.handleMetricsEvent&&(window.removeEventListener("vr:metrics",this.handleMetricsEvent),this.handleMetricsEvent=null),(e=this.qualityIndicator)==null||e.remove(),this.qualityIndicator=null,(i=this.sceneGuideDrawer)==null||i.remove(),this.sceneGuideDrawer=null,(o=this.guideTray)==null||o.remove(),this.guideTray=null,(r=this.videoPlayer)==null||r.remove(),this.videoPlayer=null,(l=this.hotspots)==null||l.remove(),this.hotspots=null,this.topModeTabs&&(this.topModeTabs.getElement().remove(),this.topModeTabs=null),(s=this.bottomDock)==null||s.remove(),this.bottomDock=null}async openGuideTray(){var e;await this.mountDeferred(),!(this.disposed||!this.isAlive())&&((e=this.guideTray)==null||e.setVisible(!0))}async openSceneGuideDrawer(){var e;if(await this.mountDeferred(),!(this.disposed||!this.isAlive())){if(!this.sceneGuideDrawer){const{SceneGuideDrawer:i}=await this.loadSceneGuideDrawerModule();if(this.disposed||!this.isAlive())return;this.sceneGuideDrawer=new i({museumId:this.options.museum.id,currentSceneId:this.options.scene.id,scenes:this.options.museum.scenes,onClose:()=>{}}),this.options.appElement.appendChild(this.sceneGuideDrawer.getElement())}(e=this.guideTray)==null||e.setVisible(!1),this.sceneGuideDrawer.open()}}async mountObserver(){if(!(this.observerMounted||this.observerMounting||this.disposed||!this.isAlive())){this.observerMounting=!0;try{const{QualityIndicator:e}=await this.loadQualityIndicatorModule();if(this.observerMounted||this.disposed||!this.isAlive())return;this.qualityIndicator||(this.qualityIndicator=new e,this.options.appElement.appendChild(this.qualityIndicator.getElement()));const i=this.options.getPanoViewer();i&&this.qualityIndicator.updateStatus(i.getLoadStatus()),this.handleMetricsEvent||(this.handleMetricsEvent=o=>{if(!this.qualityIndicator)return;const r=o.detail||{};this.qualityIndicator.updateMetrics(r)},window.addEventListener("vr:metrics",this.handleMetricsEvent)),this.observerMounted=!0}finally{this.observerMounting=!1}}}loadVideoPlayerModule(){return this.videoPlayerModulePromise||(this.videoPlayerModulePromise=d(()=>import("./VideoPlayer-hyuQhf2k.js"),__vite__mapDeps([8,1,4]),import.meta.url)),this.videoPlayerModulePromise}loadGuideTrayModule(){return this.guideTrayModulePromise||(this.guideTrayModulePromise=d(()=>import("./GuideTray-DTU6fKkr.js"),__vite__mapDeps([9,1,10,4]),import.meta.url)),this.guideTrayModulePromise}loadSceneGuideDrawerModule(){return this.sceneGuideDrawerModulePromise||(this.sceneGuideDrawerModulePromise=d(()=>import("./SceneGuideDrawer-C210sT8t.js"),__vite__mapDeps([11,1,10,3,4]),import.meta.url)),this.sceneGuideDrawerModulePromise}loadQualityIndicatorModule(){return this.qualityIndicatorModulePromise||(this.qualityIndicatorModulePromise=d(()=>import("./QualityIndicator-Nn0Chj1w.js"),__vite__mapDeps([12,1,4]),import.meta.url)),this.qualityIndicatorModulePromise}isAlive(){if(this.disposed)return!1;const e=this.options.getCurrentSceneId();return!!(e&&e===this.options.scene.id)}}const P=Object.freeze(Object.defineProperty({__proto__:null,SceneUiRuntime:y},Symbol.toStringTag,{value:"Module"}));function p(n){return!!(n!=null&&n.endpoint&&n.endpoint.trim())}class w{constructor(){t(this,"context",null);t(this,"contextToken",0);t(this,"initPromise",null);t(this,"panel",null)}updateContext(e){this.context=e,this.contextToken+=1}async ensureInit(){const e=this.context;if(!e||!p(e.fcChatConfig)||this.panel)return;if(this.initPromise){await this.initPromise;return}const i=this.contextToken,o=(async()=>{var c;const[{FcChatPanel:r},{FcChatClient:l}]=await Promise.all([d(()=>import("./chat-community-Cmxv6vIZ.js").then(u=>u.F),__vite__mapDeps([13,14,1,4]),import.meta.url),d(()=>import("./chat-community-Cmxv6vIZ.js").then(u=>u.f),__vite__mapDeps([13,14,1,4]),import.meta.url)]);if(i!==this.contextToken)return;const s=this.context;if(!s||!p(s.fcChatConfig))return;const v=new l({endpoint:s.fcChatConfig.endpoint,authToken:s.fcChatConfig.authToken,timeoutMs:15e3});(c=this.panel)==null||c.remove(),this.panel=new r(v,{museumId:s.museum.id,sceneId:s.scene.id,sceneTitle:s.scene.name,museumName:s.museum.name,url:window.location.href})})();this.initPromise=o.finally(()=>{this.initPromise===o&&(this.initPromise=null)}),await this.initPromise}dispose(){var e;this.contextToken+=1,this.context=null,this.initPromise=null,(e=this.panel)==null||e.remove(),this.panel=null}}const _=Object.freeze(Object.defineProperty({__proto__:null,ChatRuntime:w},Symbol.toStringTag,{value:"Module"}));export{_ as c,P as s};
