var L=Object.defineProperty;var N=(m,e,t)=>e in m?L(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t;var s=(m,e,t)=>N(m,typeof e!="symbol"?e+"":e,t);import{n as b}from"./index-DInc35Wk.js";import{toProxiedImageUrl as w}from"./externalImage-Cn8sVw7v.js";import{g as C}from"./index-DnDnySW2.js";const y="data:image/svg+xml;utf8,"+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300">
      <defs>
        <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0" stop-color="#1F2933"/>
          <stop offset="1" stop-color="#111827"/>
        </linearGradient>
      </defs>
      <rect width="100%" height="100%" fill="url(#g)"/>
      <text x="50%" y="50%" fill="rgba(255,255,255,0.72)" font-size="20" text-anchor="middle" font-family="STKaiti,Kaiti SC,KaiTi,Songti SC,SimSun,Source Han Serif SC,Noto Serif SC,serif">
        暂无封面
      </text>
    </svg>`);class T{constructor(e){s(this,"element");s(this,"isOpen",!1);s(this,"museumId");s(this,"currentSceneId");s(this,"scenes");s(this,"filteredScenes");s(this,"listEl",null);s(this,"previewImgEl",null);s(this,"previewTitleEl",null);s(this,"previewIdEl",null);s(this,"searchInputEl",null);s(this,"hoveredSceneId",null);s(this,"selectedSceneId",null);s(this,"onClose");this.museumId=e.museumId,this.currentSceneId=e.currentSceneId,this.scenes=e.scenes,this.filteredScenes=e.scenes,this.onClose=e.onClose,this.element=document.createElement("div"),this.element.className="vr-guide-drawer";const t=document.createElement("div");t.className="vr-guide-mask";const i=document.createElement("div");i.className="vr-guide-panel";const n=document.createElement("div");n.className="vr-guide-header";const d=document.createElement("div");d.className="vr-guide-header-left";const c=document.createElement("div");c.className="vr-guide-title",c.textContent="导览";const r=document.createElement("button");r.className="vr-btn vr-guide-close",r.setAttribute("aria-label","关闭"),r.textContent="×",r.addEventListener("click",h=>{h.preventDefault(),h.stopPropagation(),this.close()}),n.appendChild(d),n.appendChild(c),n.appendChild(r);const a=document.createElement("div");a.className="vr-guide-search";const u=document.createElement("span");u.className="vr-guide-search-icon",u.innerHTML=C("search");const l=document.createElement("input");l.className="vr-guide-search-input",l.type="search",l.placeholder="查找场景",a.appendChild(u),a.appendChild(l),this.searchInputEl=l;const v=document.createElement("div");v.className="vr-guide-body";const S=document.createElement("div");S.className="vr-guide-list",this.listEl=S;const p=document.createElement("div");p.className="vr-guide-preview";const o=document.createElement("img");o.className="vr-guide-preview-image",o.referrerPolicy="no-referrer",o.crossOrigin="anonymous",o.decoding="async",o.loading="lazy",this.previewImgEl=o;const f=document.createElement("div");f.className="vr-guide-preview-title",this.previewTitleEl=f;const I=document.createElement("div");I.className="vr-guide-preview-id",this.previewIdEl=I;const g=document.createElement("button");g.className="vr-btn vr-guide-preview-enter",g.innerHTML=`<span class="vr-guide-enter-icon">${C("arrow-right")}</span><span>前往</span>`,g.addEventListener("click",h=>{h.preventDefault(),h.stopPropagation();const E=this.selectedSceneId||this.currentSceneId;E&&E!==this.currentSceneId?(b(this.museumId,E),this.close()):E===this.currentSceneId&&this.close()}),p.appendChild(o),p.appendChild(f),p.appendChild(I),p.appendChild(g),v.appendChild(S),v.appendChild(p),t.addEventListener("click",()=>this.close()),i.addEventListener("click",h=>h.stopPropagation()),i.appendChild(n),i.appendChild(a),i.appendChild(v),this.element.appendChild(t),this.element.appendChild(i),this.bindSearch(),this.renderList(),this.updatePreview()}open(){this.isOpen||(this.isOpen=!0,this.element.classList.add("open"),this.updateOverlayState(),this.selectedSceneId||(this.selectedSceneId=this.currentSceneId),this.updateActiveState(),this.updatePreview())}close(){var e;this.isOpen&&(this.isOpen=!1,this.element.classList.remove("open"),this.updateOverlayState(),(e=this.onClose)==null||e.call(this))}updateOverlayState(){var t;!!(document.querySelector(".vr-modal-overlay")||document.querySelector(".vr-guide-drawer.open")&&this.isOpen||document.querySelector(".fcchat-root")&&((t=document.querySelector(".fcchat-root"))==null?void 0:t.style.display)==="flex")?document.documentElement.classList.add("vr-overlay-open"):document.documentElement.classList.remove("vr-overlay-open")}toggle(){this.isOpen?this.close():this.open()}getElement(){return this.element}remove(){this.element.remove()}setCurrentScene(e){this.currentSceneId=e,this.updateActiveState(),this.updatePreview()}bindSearch(){this.searchInputEl&&this.searchInputEl.addEventListener("input",()=>{var t;const e=(((t=this.searchInputEl)==null?void 0:t.value)||"").trim().toLowerCase();e?this.filteredScenes=this.scenes.filter(i=>(i.name||"").toLowerCase().includes(e)||i.id.toLowerCase().includes(e)):this.filteredScenes=this.scenes,this.renderList(),this.updatePreview()})}renderList(){if(this.listEl){this.listEl.innerHTML="";for(const e of this.filteredScenes){const t=document.createElement("div");t.className="vr-guide-item",t.setAttribute("data-scene-id",e.id),e.id===this.currentSceneId&&t.classList.add("active");const i=document.createElement("img");i.className="vr-guide-thumb",i.referrerPolicy="no-referrer",i.crossOrigin="anonymous",i.decoding="async",i.loading="lazy";const n=e.thumb?w(e.thumb):y;i.src=n,i.alt=e.name||e.id;const d=document.createElement("div");d.className="vr-guide-meta";const c=document.createElement("div");c.className="vr-guide-name",c.textContent=e.name||e.id;const r=document.createElement("div");r.className="vr-guide-id",r.textContent=e.id,d.appendChild(c),d.appendChild(r),t.appendChild(i),t.appendChild(d),t.addEventListener("mouseenter",()=>{this.hoveredSceneId=e.id,this.updatePreview()}),t.addEventListener("mouseleave",()=>{this.hoveredSceneId=null,this.updatePreview()}),t.addEventListener("click",a=>{var u;a.preventDefault(),a.stopPropagation(),this.selectedSceneId=e.id,(u=this.listEl)==null||u.querySelectorAll(".vr-guide-item").forEach(l=>{l.classList.remove("selected")}),t.classList.add("selected"),this.updatePreview()}),this.listEl.appendChild(t)}}}updateActiveState(){this.listEl&&this.listEl.querySelectorAll(".vr-guide-item").forEach(e=>{const i=e.getAttribute("data-scene-id")===this.currentSceneId;e.classList.toggle("active",i),i&&!this.selectedSceneId&&(this.selectedSceneId=this.currentSceneId,e.classList.add("selected"))})}updatePreview(){if(!this.previewImgEl||!this.previewTitleEl||!this.previewIdEl)return;const e=this.selectedSceneId||this.hoveredSceneId||this.currentSceneId,t=this.scenes.find(n=>n.id===e)||this.scenes[0];if(!t)return;const i=t.thumb?w(t.thumb):y;this.previewImgEl.src=i,this.previewImgEl.alt=t.name||t.id,this.previewTitleEl.textContent=t.name||t.id,this.previewIdEl.textContent=t.id}}export{T as SceneGuideDrawer};
