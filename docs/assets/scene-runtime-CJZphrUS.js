const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BottomDock-DSOhd8WW.js","./index-DLhNDJoj.js","./Modal-Cmv3TBkb.js","./index-DnDnySW2.js","./index-BfJu72vJ.css","./Hotspots-6-6NoY7i.js","./three-renderer-DqCmgmK_.js","./VideoPlayer-vcPDubnN.js","./GuideTray-BP4uxZyk.js","./externalImage-Cn8sVw7v.js","./SceneGuideDrawer-B5pBoIZv.js","./QualityIndicator-CnGM1JkZ.js","./dock-panels-cjWIZ9lO.js","./chat-community-Bh7n16cj.js","./store-B83L8bDT.js"])))=>i.map(i=>d[i]);
var M=Object.defineProperty;var v=(n,e,i)=>e in n?M(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i;var t=(n,e,i)=>v(n,typeof e!="symbol"?e+"":e,i);import{_ as l,L as m}from"./index-DLhNDJoj.js";import{W as f}from"./warmupScheduler-BuQoOsNR.js";const a=typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback:null,u=typeof window<"u"&&"cancelIdleCallback"in window?window.cancelIdleCallback:null;class y{constructor(e){t(this,"options");t(this,"disposed",!1);t(this,"coreMounted",!1);t(this,"coreMounting",!1);t(this,"deferredMounted",!1);t(this,"deferredMounting",!1);t(this,"observerMounted",!1);t(this,"observerMounting",!1);t(this,"observerIdleHandle",null);t(this,"featureWarmupStarted",!1);t(this,"warmupScheduler",new f);t(this,"bottomDock",null);t(this,"topModeTabs",null);t(this,"hotspots",null);t(this,"videoPlayer",null);t(this,"guideTray",null);t(this,"sceneGuideDrawer",null);t(this,"qualityIndicator",null);t(this,"handleMetricsEvent",null);t(this,"videoPlayerModulePromise",null);t(this,"guideTrayModulePromise",null);t(this,"sceneGuideDrawerModulePromise",null);t(this,"qualityIndicatorModulePromise",null);t(this,"dockPanelsModulePromise",null);t(this,"communityPanelModulePromise",null);this.options=e}getBottomDock(){return this.bottomDock}getTopModeTabs(){return this.topModeTabs}getHotspots(){return this.hotspots}getVideoPlayer(){return this.videoPlayer}getGuideTray(){return this.guideTray}getSceneGuideDrawer(){return this.sceneGuideDrawer}getQualityIndicator(){return this.qualityIndicator}async ensureQualityIndicatorMounted(){await this.mountObserver()}async mountCore(){if(!(this.coreMounted||this.coreMounting||this.disposed||!this.isAlive())){this.coreMounting=!0;try{const[{BottomDock:e},{TopModeTabs:i},{Hotspots:s}]=await Promise.all([l(()=>import("./BottomDock-DSOhd8WW.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),l(()=>import("./TopModeTabs-psisWFio.js"),[],import.meta.url),l(()=>import("./Hotspots-6-6NoY7i.js"),__vite__mapDeps([5,6,1,4]),import.meta.url)]);if(this.coreMounted||this.disposed||!this.isAlive())return;const r=this.options.getPanoViewer();if(!r)return;const d=new Map(this.options.museum.scenes.map(o=>[o.id,o.name]));this.bottomDock=new e({onGuideClick:()=>{this.openGuideTray()},onOpenCommunity:()=>{this.options.onOpenCommunity()},onOpenInfo:this.options.onOpenInfo,onOpenSettings:this.options.onOpenSettings,sceneId:this.options.scene.id,sceneName:this.options.scene.name,museum:this.options.museum,scenes:this.options.museum.scenes,currentSceneId:this.options.scene.id}),this.options.appElement.appendChild(this.bottomDock.getElement()),this.topModeTabs=new i({initialMode:this.options.initialMode,onModeChange:this.options.onModeChange}),this.options.appElement.appendChild(this.topModeTabs.getElement()),this.hotspots=new s(r,this.options.scene.hotspots,{resolveSceneName:o=>d.get(o),onEnterScene:this.options.onEnterScene,museumId:this.options.museum.id}),this.options.viewerContainer.appendChild(this.hotspots.getElement()),this.coreMounted=!0}finally{this.coreMounting=!1}}}async mountDeferred(){if(!(this.deferredMounted||this.deferredMounting||this.disposed||!this.isAlive())){this.deferredMounting=!0;try{const[{VideoPlayer:e},{GuideTray:i}]=await Promise.all([this.loadVideoPlayerModule(),this.loadGuideTrayModule()]);if(this.deferredMounted||this.disposed||!this.isAlive())return;this.videoPlayer||(this.videoPlayer=new e,this.options.appElement.appendChild(this.videoPlayer.getElement())),this.guideTray||(this.guideTray=new i({museumId:this.options.museum.id,currentSceneId:this.options.scene.id,scenes:this.options.museum.scenes,onSceneClick:s=>{this.options.onEnterScene(s)},onMoreClick:()=>{this.openSceneGuideDrawer()},onClose:()=>{var s;(s=this.guideTray)==null||s.setVisible(!1),window.dispatchEvent(new CustomEvent("vr:dock-tab-close",{detail:{tab:"guide"}}))}}),this.guideTray.setVisible(!1),this.options.appElement.appendChild(this.guideTray.getElement())),this.deferredMounted=!0}finally{this.deferredMounting=!1}}}scheduleObserverMount(){if(!(this.observerMounted||this.observerMounting||this.disposed||this.observerIdleHandle!==null)){if(a&&u){this.observerIdleHandle=a(()=>{this.observerIdleHandle=null,this.mountObserver()},{timeout:1200});return}this.observerIdleHandle=window.setTimeout(()=>{this.observerIdleHandle=null,this.mountObserver()},500)}}scheduleFeatureWarmup(e="idle"){if(this.featureWarmupStarted||this.disposed||!this.isAlive())return;this.featureWarmupStarted=!0;const i=[{task:()=>this.loadGuideTrayModule(),priority:"high"},{task:()=>this.loadSceneGuideDrawerModule(),priority:"high"},{task:()=>this.loadVideoPlayerModule(),priority:"high"},{task:()=>{var s,r;return Promise.resolve((r=(s=this.options).onWarmupFeatures)==null?void 0:r.call(s))},priority:"normal"},{task:()=>this.loadDockPanelsModule(),priority:"normal"},{task:()=>this.loadCommunityPanelModule(),priority:"low"}];this.warmupScheduler.schedule(i,e)}handleStatusChange(e){var i;(i=this.qualityIndicator)==null||i.updateStatus(e),!this.observerMounted&&!this.observerMounting&&!this.disposed&&this.mountObserver(),e===m.HIGH_READY?this.scheduleFeatureWarmup("immediate"):e===m.DEGRADED&&this.scheduleFeatureWarmup("idle")}dispose(){var e,i,s,r,d,o;this.disposed=!0,this.observerIdleHandle!==null&&(a&&u?u(this.observerIdleHandle):clearTimeout(this.observerIdleHandle),this.observerIdleHandle=null),this.warmupScheduler.dispose(),this.handleMetricsEvent&&(window.removeEventListener("vr:metrics",this.handleMetricsEvent),this.handleMetricsEvent=null),(e=this.qualityIndicator)==null||e.remove(),this.qualityIndicator=null,(i=this.sceneGuideDrawer)==null||i.remove(),this.sceneGuideDrawer=null,(s=this.guideTray)==null||s.remove(),this.guideTray=null,(r=this.videoPlayer)==null||r.remove(),this.videoPlayer=null,(d=this.hotspots)==null||d.remove(),this.hotspots=null,this.topModeTabs&&(this.topModeTabs.getElement().remove(),this.topModeTabs=null),(o=this.bottomDock)==null||o.remove(),this.bottomDock=null}async openGuideTray(){var e;await this.mountDeferred(),!(this.disposed||!this.isAlive())&&((e=this.guideTray)==null||e.setVisible(!0))}async openSceneGuideDrawer(){var e;if(await this.mountDeferred(),!(this.disposed||!this.isAlive())){if(!this.sceneGuideDrawer){const{SceneGuideDrawer:i}=await this.loadSceneGuideDrawerModule();if(this.disposed||!this.isAlive())return;this.sceneGuideDrawer=new i({museumId:this.options.museum.id,currentSceneId:this.options.scene.id,scenes:this.options.museum.scenes,onClose:()=>{}}),this.options.appElement.appendChild(this.sceneGuideDrawer.getElement())}(e=this.guideTray)==null||e.setVisible(!1),this.sceneGuideDrawer.open()}}async mountObserver(){if(!(this.observerMounted||this.observerMounting||this.disposed||!this.isAlive())){this.observerMounting=!0;try{const{QualityIndicator:e}=await this.loadQualityIndicatorModule();if(this.observerMounted||this.disposed||!this.isAlive())return;this.qualityIndicator||(this.qualityIndicator=new e,this.options.appElement.appendChild(this.qualityIndicator.getElement()));const i=this.options.getPanoViewer();i&&this.qualityIndicator.updateStatus(i.getLoadStatus()),this.handleMetricsEvent||(this.handleMetricsEvent=s=>{if(!this.qualityIndicator)return;const r=s.detail||{};this.qualityIndicator.updateMetrics(r)},window.addEventListener("vr:metrics",this.handleMetricsEvent)),this.observerMounted=!0}finally{this.observerMounting=!1}}}loadVideoPlayerModule(){return this.videoPlayerModulePromise||(this.videoPlayerModulePromise=l(()=>import("./VideoPlayer-vcPDubnN.js"),__vite__mapDeps([7,1,4]),import.meta.url)),this.videoPlayerModulePromise}loadGuideTrayModule(){return this.guideTrayModulePromise||(this.guideTrayModulePromise=l(()=>import("./GuideTray-BP4uxZyk.js"),__vite__mapDeps([8,1,9,4]),import.meta.url)),this.guideTrayModulePromise}loadSceneGuideDrawerModule(){return this.sceneGuideDrawerModulePromise||(this.sceneGuideDrawerModulePromise=l(()=>import("./SceneGuideDrawer-B5pBoIZv.js"),__vite__mapDeps([10,1,9,3,4]),import.meta.url)),this.sceneGuideDrawerModulePromise}loadQualityIndicatorModule(){return this.qualityIndicatorModulePromise||(this.qualityIndicatorModulePromise=l(()=>import("./QualityIndicator-CnGM1JkZ.js"),__vite__mapDeps([11,1,4]),import.meta.url)),this.qualityIndicatorModulePromise}loadDockPanelsModule(){return this.dockPanelsModulePromise||(this.dockPanelsModulePromise=l(()=>import("./dock-panels-cjWIZ9lO.js").then(e=>e.D),__vite__mapDeps([12,1,4]),import.meta.url)),this.dockPanelsModulePromise}loadCommunityPanelModule(){return this.communityPanelModulePromise||(this.communityPanelModulePromise=l(()=>import("./chat-community-Bh7n16cj.js").then(e=>e.C),__vite__mapDeps([13,14,1,4]),import.meta.url)),this.communityPanelModulePromise}isAlive(){if(this.disposed)return!1;const e=this.options.getCurrentSceneId();return!!(e&&e===this.options.scene.id)}}const I=Object.freeze(Object.defineProperty({__proto__:null,SceneUiRuntime:y},Symbol.toStringTag,{value:"Module"}));function h(n){return!!(n!=null&&n.endpoint&&n.endpoint.trim())}class P{constructor(){t(this,"context",null);t(this,"contextToken",0);t(this,"initPromise",null);t(this,"panel",null);t(this,"chatModulesPromise",null)}updateContext(e){this.context=e,this.contextToken+=1}async warmup(){const e=this.context;if(!(!e||!h(e.fcChatConfig)))try{await this.loadChatModules()}catch{}}async ensureInit(){const e=this.context;if(!e||!h(e.fcChatConfig)||this.panel)return;if(this.initPromise){await this.initPromise;return}const i=this.contextToken,s=(async()=>{var c;const{FcChatPanel:r,FcChatClient:d}=await this.loadChatModules();if(i!==this.contextToken)return;const o=this.context;if(!o||!h(o.fcChatConfig))return;const p=new d({endpoint:o.fcChatConfig.endpoint,authToken:o.fcChatConfig.authToken,timeoutMs:15e3});(c=this.panel)==null||c.remove(),this.panel=new r(p,{museumId:o.museum.id,sceneId:o.scene.id,sceneTitle:o.scene.name,museumName:o.museum.name,url:window.location.href})})();this.initPromise=s.finally(()=>{this.initPromise===s&&(this.initPromise=null)}),await this.initPromise}dispose(){var e;this.contextToken+=1,this.context=null,this.initPromise=null,(e=this.panel)==null||e.remove(),this.panel=null}loadChatModules(){return this.chatModulesPromise||(this.chatModulesPromise=Promise.all([l(()=>import("./chat-community-Bh7n16cj.js").then(e=>e.F),__vite__mapDeps([13,14,1,4]),import.meta.url),l(()=>import("./chat-community-Bh7n16cj.js").then(e=>e.f),__vite__mapDeps([13,14,1,4]),import.meta.url)]).then(([e,i])=>({FcChatPanel:e.FcChatPanel,FcChatClient:i.FcChatClient}))),this.chatModulesPromise}}const b=Object.freeze(Object.defineProperty({__proto__:null,ChatRuntime:P},Symbol.toStringTag,{value:"Module"}));export{b as c,I as s};
